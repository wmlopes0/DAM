-- BASE DE DATOS MUSICA
-- 1º DAW
-- 12-01-2023
-- WALTER MARTIN LOPES
-- -------------------------------------------------------
-- CREACION DE LA BBDD MUSICA
CREATE DATABASE MUSICA;
USE MUSICA;

-- CREACION DE LAS TABLAS
CREATE TABLE GRUPO(
NUMERO_GRUPO INT PRIMARY KEY,
NOMBRE VARCHAR(20) NOT NULL UNIQUE,
AÑO_CREACION INT);

CREATE TABLE INTEGRANTES(
NUMERO_INTEGRANTE INT AUTO_INCREMENT,
NUMERO_GRUPO INT,
NOMBRE VARCHAR(20) NOT NULL,
APELLIDOS VARCHAR(25),
AÑO_NACIMIENTO INT,
CONSTRAINT IG_PK PRIMARY KEY(NUMERO_INTEGRANTE,NUMERO_GRUPO),
CONSTRAINT NG_FK FOREIGN KEY(NUMERO_GRUPO) REFERENCES GRUPO(NUMERO_GRUPO));

CREATE TABLE DISCOS(
NUMERO_DISCO INT,
NUMERO_GRUPO INT,
TITULO VARCHAR(23) NOT NULL,
AÑO_CREACION INT,
CONSTRAINT DG_PK PRIMARY KEY(NUMERO_DISCO,NUMERO_GRUPO),
CONSTRAINT NGR_FK FOREIGN KEY(NUMERO_GRUPO) REFERENCES GRUPO(NUMERO_GRUPO));

CREATE TABLE CANCIONES(
NUMERO_GRUPO INT,
NUMERO_DISCO INT,
NUMERO_CANCION INT,
TITULO VARCHAR(23) NOT NULL,
DURACION DECIMAL(2,2),
CONSTRAINT GDC_PK PRIMARY KEY(NUMERO_GRUPO,NUMERO_DISCO,NUMERO_CANCION),
CONSTRAINT NGRU_FK FOREIGN KEY(NUMERO_GRUPO) REFERENCES GRUPO(NUMERO_GRUPO),
CONSTRAINT NDIS_FK FOREIGN KEY(NUMERO_DISCO) REFERENCES DISCOS(NUMERO_DISCO)
);

-- INSERTO DATOS
INSERT INTO GRUPO 
VALUES ('1','GRUPO1',2005),
		('2','GRUPO2',2020);

SELECT * FROM GRUPO;

INSERT INTO INTEGRANTES
VALUES (1,1,'PEPE','MARTIN',1989),
		(2,1,'MARIA','LOPEZ',1990);

INSERT INTO INTEGRANTES
VALUES (1,2,'PEDFDSPE','MARTASDIN',1889),
		(2,2,'ASDF','DFDS',1990),
		(3,2,'MARIASDFA','LOASDFSADFPEZ',1490);
        
SELECT * FROM INTEGRANTES;

INSERT INTO DISCOS 
VALUES ('1','1','ASDFASDF','2000'),
		('2','2','ASDFASDSDF','2030'),
		('3','1','ASDFADSDF','2004');
        
SELECT * FROM DISCOS;

INSERT INTO CANCIONES 
VALUES (1,1,1,'ASDFASDF',1.20),
		(2,2,1,'ASDFASDF',1.30),
        (1,3,1,'ASDFASDF',1.40),
        (2,1,2,'ASDFASDF',1.70);

-- MODIFICO LAS FK AÑADIENDO LAS OPCIONES DE BORRADO --------------------------------------------
ALTER TABLE INTEGRANTES
DROP CONSTRAINT NG_FK;

ALTER TABLE INTEGRANTES
ADD CONSTRAINT NG_FK FOREIGN KEY(NUMERO_GRUPO) REFERENCES GRUPO(NUMERO_GRUPO) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE DISCOS
DROP CONSTRAINT NGR_FK;

ALTER TABLE DISCOS
ADD CONSTRAINT NGR_FK FOREIGN KEY(NUMERO_GRUPO) REFERENCES GRUPO(NUMERO_GRUPO) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CANCIONES
DROP CONSTRAINT NGRU_FK,
DROP CONSTRAINT NDIS_FK;

ALTER TABLE CANCIONES 
ADD CONSTRAINT NGRU_FK FOREIGN KEY(NUMERO_GRUPO) REFERENCES GRUPO(NUMERO_GRUPO) ON UPDATE CASCADE ON DELETE CASCADE,
ADD CONSTRAINT NDIS_FK FOREIGN KEY(NUMERO_DISCO) REFERENCES DISCOS(NUMERO_DISCO) ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE CANCIONES 
MODIFY DURACION DECIMAL (8,5);

-- FIN MODIFICACION BORRADOS--------------------------------------------------------------------------